<html>
<head>
	<title>Pronostico de viento Rio de la Plata : GeoJSON + Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	<link rel="stylesheet" href="leaflet.css" />
	<link rel="stylesheet" href="leaflet.label.css" />
	<script src="leaflet.js"></script>
	<script src="leaflet.label.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	</style>

	
</head>
<body>


<div id='map'></div>


<script>
	var center = [-34.472,-58.489];
	var WindIcon = L.Icon.extend({
	options: {
	iconSize:     [35, 35],
        shadowSize:   [50, 64],
        shadowAnchor: [4, 62],
        popupAnchor:  [-3, -76]
	}
	});
	var Viento_e = new WindIcon({iconUrl: 'v-e.png'});
	var Viento_o = new WindIcon({iconUrl: 'v-o.png'});
	var Viento_ne = new WindIcon({iconUrl: 'v-ne.png'});

	var map = L.map('map').setView(center, 15);
	var osmUrl = ' http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
	var osmTiles = new L.TileLayer(osmUrl, {maxZoom: 18});
	L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/light-v9',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);


	//L.marker(center).addTo(map);
	var pointA = L.latLng(-34.4722, -58.480);
	var pointB = L.latLng(-34.473, -58.483);
	var pointC = L.latLng(-34.474, -58.480);
	var pointList = [pointA, pointB, pointC, pointA];
	// Jugando con lineas
	//L.polyline(pointList).addTo(map);

	var imageBounds = [ [-34.465,-58.483] , [ -34.47, -58.477 ] ];
	L.imageOverlay('768px-Rosa_de_los_vientos.svg.png', imageBounds).addTo(map);

	var initial_point_y = -34.469;
	var initial_point_x = -58.486;

	// Algo de jquery / ajax viene tan bien:
$(document).ready(function() {
    $.ajax({
        type: "GET",
        url: "https://raw.githubusercontent.com/wlamagna/viz1/master/clima/BUENOS_AIRES.csv",
        dataType: "text",
        success: function(data) { leerDatosDelTiempo(data);}
     });
});

	// Leer el CSV y extraer la direccion pronosticada:
function leerDatosDelTiempo(allText) {
    var record_num = 5;  // elementos por columna
    var allTextLines = allText.split(/\r\n|\n/);
	console.log(allTextLines.length);
	//console.log(allTextLines);
    var entries = allTextLines[0].split(',');
    var lines = [];
    var headings = entries.splice(0,record_num);
    while (entries.length>0) {
        var tarr = [];
        for (var j=0; j<record_num; j++) {
            tarr.push(headings[j]+":"+entries.shift());
        }
        lines.push(tarr);
    }
    // alert(lines);
}

	// Agregado como marcador permite adjuntar un texto:
	L.marker([initial_point_y, initial_point_x], {draggable: true, icon: Viento_e})
	.bindLabel('Lunes', { noHide: true })
	.addTo(map);

	initial_point_y -= 0.002;
	L.marker([initial_point_y, initial_point_x], {draggable: true, icon: Viento_o})
	.bindLabel('Martes', { noHide: true })
	.addTo(map);

	initial_point_y -= 0.002;
	L.marker([initial_point_y, initial_point_x], {draggable: true, icon: Viento_ne})
	.bindLabel('Miercoles', { noHide: true })
	.addTo(map);

	//L.imageOverlay(imageUrl, imageBounds).bringToFront();

</script>

</body>
</html>
